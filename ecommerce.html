<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>в░ћВЮ┤ВўцвІи ВЮ┤В╗цвеИВіц вХёВёЮ (Ж░ђВцЉьЈЅВаљ ВХћЖ░ђ)</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div id="page-loading-message" class="loading-message">
    <h2>в░ћВЮ┤ВўцвІи вїђВІюв│┤вЊювАю ВЮ┤вЈЎ ВцЉ...</h2>
    <p>ВъаВІювДї ЖИ░вІцвацВБ╝ВёИВџћ.</p>
  </div>

  <header>
    <div class="container">
      <h1>в░ћВЮ┤ВўцвІи ВЮ┤В╗цвеИВіц вХёВёЮ</h1>
      <nav>
        <ul style="list-style:none; display:flex; gap:20px;">
          <li><a href="index.html">ьЎѕ</a></li>
          <li><a href="survey.html">ВёцвгИВА░Вѓг вХёВёЮ</a></li>
          <li><a href="ecommerce.html" style="color:#3498db; font-weight:bold;">ВЮ┤В╗цвеИВіц вХёВёЮ</a></li>
          <li><a href="text-analysis.html">ьЁЇВіцьіИ вХёВёЮ</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section>
      <h2>1) вдгви░ Вѕў ЖИ░Вцђ ВаЋваг</h2>
      <canvas id="reviewCountChart"></canvas>
    </section>
    <section>
      <h2>2) ьЈЅЖиа ьЈЅВаљ ЖИ░Вцђ ВаЋваг</h2>
      <canvas id="ratingChart"></canvas>
    </section>

    <section style="margin-top:40px;">
      <h2>Ж░ђВцЉьЈЅВаљ Ж│ёВѓ░ ВёцвфЁ</h2>
      <p>вдгви░Ж░ђ ВаЂВю╝вЕ┤ ВѕФВъљ ьЋўвѓўвАювіћ в»┐ЖИ░ Вќ┤вацВџ░вІѕЖ╣ї, вфевЉљВЮў ьЈЅЖиаВЮё ВА░ЖИѕ ВёъВќ┤Вёю Ж│ёВѓ░ьЋ┤Вџћ.</p>
      <ul>
        <li>­ЪЊі ВаёВ▓┤ ьЈЅЖиа ьЈЅВаљ: <strong>3.93Ваљ</strong> (вфевЊа ВЃЂьњѕВЮў ьЈЅЖиа)</li>
        <li>­Ъћб ВхюВєї вдгви░ Вѕў ЖИ░Вцђ: <strong>40Ж░ю</strong> (ВЮ┤ ВаЋвЈёвЕ┤ Рђюв»┐ВЮё вДїьЋўвІцРђЮЖ│а ьїљвІе)</li>
      </ul>
      <p>РюЈ№ИЈ <strong>Ж│хВаЋьЋю ьЈЅВаљ Ж│хВІЮ</strong>:</p>
      <pre style="background:#f0f0f0; padding:10px;">
    (РГљРђ»ьЈЅЖиаВаљВѕўРђ»├ЌРђ»вдгви░Вѕў + ­Ъј»Рђ»В┤ѕЖ╣ЃЖ░њРђ»├ЌРђ»­ЪД« ЖИ░Вцђвдгви░Вѕў) ├и (вдгви░Вѕў + ­ЪД« ЖИ░Вцђвдгви░Вѕў)
  = (вдгви░Вѕў / (вдгви░Вѕў + ­ЪД« 40)) ├Ќ РГљ ьЈЅЖиаВаљВѕў + (­ЪД« 40 / (вдгви░Вѕў + ­ЪД« 40)) ├Ќ ­Ъј» 3.93 </pre>
      <p>­ЪЇ░ ВўѕВІю:</p>
      <ol>
        <li><strong>A В╝ђВЮ┤ьЂг</strong> (вдгви░ 2Ж░ю, ьЈЅВаљ 5.0)<br>
          Рєњ (2/42)├Ќ5.0 + (40/42)├Ќ3.93 РЅѕ <strong>3.98Ваљ</strong>
        </li>
        <li><strong>B В╝ђВЮ┤ьЂг</strong> (вдгви░ 100Ж░ю, ьЈЅВаљ 4.2)<br>
          Рєњ (100/140)├Ќ4.2 + (40/140)├Ќ3.93 РЅѕ <strong>4.12Ваљ</strong>
        </li>
      </ol>
      <p>Рђювдгви░Ж░ђ вДјВю╝вЕ┤ ВДёВДю ьЈЅВаљВЮё, ВаЂВю╝вЕ┤ ьЈЅЖиаВЮё вЇћ ВёъВќ┤Вёю!РђЮ</p>
    </section>

    <section>
      <h2>3) в│┤ВаЋ ьЈЅВаљ (Weighted Rating) ЖИ░Вцђ ВаЋваг</h2>
      <canvas id="weightedChart"></canvas>
    </section>

  </main>

  <footer>
    <div class="container">
      <p>┬Е 2025 в░ћВЮ┤ВўцвІи вЇ░ВЮ┤ьё░ ВІюЖ░ЂьЎћ ьћёвАюВаЮьіИ</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loading = document.getElementById('page-loading-message');
      const M = 40;                    // ЖИ░Вцђ вдгви░ Вѕў
      const GLOBAL_AVG = 3.93;         // ВаёВ▓┤ ьЈЅЖиа ьЈЅВаљ

      fetch('data/ьЋювЈЎвЁ╣ВџЕВЌ░ЖхгВєї_ВЮ┤В╗цвеИВіцвЇ░ВЮ┤ьё░__2025-04-25.xlsx')
        .then(res => res.arrayBuffer())
        .then(data => {
          const wb = XLSX.read(data, { type:'array' });
          const rows = XLSX.utils.sheet_to_json(wb.Sheets['products']);

          // ВЏљв│И в░░ВЌ┤ в│хВаю
          const byReview = [...rows].sort((a,b)=>b['вдгви░Вѕў']-a['вдгви░Вѕў']);
          const byRating = [...rows].sort((a,b)=>b['ВІцВаю ьЈЅЖиа вдгви░в│ёВаљ']-a['ВІцВаю ьЈЅЖиа вдгви░в│ёВаљ']);

          // в│┤ВаЋ ьЈЅВаљ ВХћЖ░ђ & ВаЋваг
          const withWeighted = rows.map(r => {
            const n = r['вдгви░Вѕў'] || 0;
            const score = r['ВІцВаю ьЈЅЖиа вдгви░в│ёВаљ'] || 0;
            const weighted = (n / (n + M)) * score + (M / (n + M)) * GLOBAL_AVG;
            return { ВаюьњѕвфЁ: r['ВаюьњѕвфЁ'], weighted };
          }).sort((a,b)=>b.weighted - a.weighted);

          // РЉа вдгви░ Вѕў В░еьіИ
          new Chart(
            document.getElementById('reviewCountChart').getContext('2d'),
            { type:'bar',
              data:{
                labels: byReview.map(r=>r['ВаюьњѕвфЁ']),
                datasets:[{ label:'вдгви░ Вѕў', data:byReview.map(r=>r['вдгви░Вѕў']), backgroundColor:'rgba(255,99,132,0.5)' }]
              },
              options:{ scales:{ y:{ beginAtZero:true } } }
            }
          );

          // РЉА ьЈЅЖиа ьЈЅВаљ В░еьіИ
          new Chart(
            document.getElementById('ratingChart').getContext('2d'),
            { type:'bar',
              data:{
                labels: byRating.map(r=>r['ВаюьњѕвфЁ']),
                datasets:[{ label:'ьЈЅЖиа ьЈЅВаљ', data:byRating.map(r=>r['ВІцВаю ьЈЅЖиа вдгви░в│ёВаљ']), backgroundColor:'rgba(54,162,235,0.5)' }]
              },
              options:{ scales:{ y:{ beginAtZero:true, max:5 } } }
            }
          );

          // РЉб в│┤ВаЋ ьЈЅВаљ В░еьіИ
          new Chart(
            document.getElementById('weightedChart').getContext('2d'),
            { type:'bar',
              data:{
                labels: withWeighted.map(r=>r['ВаюьњѕвфЁ']),
                datasets:[{ label:'в│┤ВаЋ ьЈЅВаљ', data:withWeighted.map(r=>r.weighted.toFixed(2)), backgroundColor:'rgba(75,192,192,0.5)' }]
              },
              options:{ scales:{ y:{ beginAtZero:true, max:5 } } }
            }
          );
        })
        .catch(console.error)
        .finally(()=>{ loading.style.display='none'; });
    });
  </script>
</body>
</html>
